window.app.controller("QueueCtrl",["$rootScope","$scope","$http",function($rootScope,$scope,$http){function _getServedCustomers(){return $http.get("/api/customers/served").then(function(res){$rootScope.customersServed=res.data})}function _getCustomers(){return $http.get("/api/customers").then(function(res){$rootScope.customers=res.data})}$rootScope.customers=[],$rootScope.customersServed=[],_getCustomers(),_getServedCustomers(),$scope.onCustomerAdded=function(){_getCustomers()},$scope.onCustomerRemoved=function(){_getCustomers()},$scope.onCustomerServed=function(){_getCustomers(),_getServedCustomers()}}]);
window.app.directive("addCustomer",["$rootScope","$http","$timeout",function($rootScope,$http,$timeout){return{restrict:"E",scope:{onAdded:"&"},templateUrl:"/add-customer/add-customer.html",link:function(scope){scope.products=[{name:"Grammatical advice"},{name:"Magnifying glass repair"},{name:"Cryptography advice"}],scope.addCustomer=function(){if(scope.product&&scope.name)var req=$timeout(function(){$http.post("/api/customer/add",{name:scope.name,product:scope.product}).then(function(result){$rootScope.customers=result.data}),$timeout.cancel(req)},200);else scope.product||alert("Please select a product!"),scope.name||alert("Please enter the customer's name")}}}}]);
window.app.directive("customer",["$http","$rootScope",function($http,$rootScope){return{restrict:"E",scope:{customer:"=",served:"=",onRemoved:"&",onServed:"&"},templateUrl:"/customer/customer.html",controller:function($scope){$scope.formateDate=function(date){var d=new Date(date),monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];return monthNames[d.getMonth()]+" "+d.getDate()+", "+d.getFullYear()+". "+d.getHours()+":"+d.getMinutes()}},link:function(scope){scope.queuedTime=new Date-new Date(scope.customer.joinedTime),scope.remove=function(){$http({method:"DELETE",url:"/api/customer/remove",params:{id:scope.customer.id}}).then(function(res){scope.onRemoved()})},scope.serve=function(){({id:scope.id,name:scope.name,product:{name:scope.product}});$http.post("/api/customer/serve",{id:scope.id}).then(function(res){$rootScope.customers=res.data.customers,$rootScope.customersServed=res.data.servedCustomers})}}}}]);